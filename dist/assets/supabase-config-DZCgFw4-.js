(function(){const s=document.createElement("link").relList;if(s&&s.supports&&s.supports("modulepreload"))return;for(const e of document.querySelectorAll('link[rel="modulepreload"]'))r(e);new MutationObserver(e=>{for(const o of e)if(o.type==="childList")for(const n of o.addedNodes)n.tagName==="LINK"&&n.rel==="modulepreload"&&r(n)}).observe(document,{childList:!0,subtree:!0});function t(e){const o={};return e.integrity&&(o.integrity=e.integrity),e.referrerPolicy&&(o.referrerPolicy=e.referrerPolicy),e.crossOrigin==="use-credentials"?o.credentials="include":e.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function r(e){if(e.ep)return;e.ep=!0;const o=t(e);fetch(e.href,o)}})();const h="https://fbyfbvxwbyksnvibyypu.supabase.co",f="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImZieWZidnh3Ynlrc252aWJ5eXB1Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjQ1MDc0MjksImV4cCI6MjA4MDA4MzQyOX0.IKTvSGWXVKLJHNw1sUjed3h9W5jTMnMhWUzv14v2xyQ";console.log("ðŸš€ Starting Supabase initialization...");let u,d;try{if(!window.supabase||!window.supabase.createClient)throw console.error("âŒ Supabase JS library not loaded!"),new Error("Supabase JS library not found");console.log("ðŸ“¦ Supabase library found, creating client..."),u=window.supabase.createClient(h,f,{auth:{persistSession:!1,autoRefreshToken:!1},db:{schema:"public"},global:{headers:{"Content-Type":"application/json"}}}),console.log("âœ… Supabase client created");class a{constructor(){this.client=u,this.isConnected=!1,this.connectionChecked=!1,console.log("ðŸ”„ SupabaseService instance created")}async checkConnection(){if(this.connectionChecked)return console.log("ðŸ“¡ Connection already checked"),this.isConnected;console.log("ðŸ”Œ Checking Supabase connection...");try{const{data:t,error:r}=await this.client.from("notes").select("count",{count:"exact",head:!0}).limit(1);return r?(console.error("âŒ Connection test failed:",r.message),this.isConnected=!1):(console.log("âœ… Connection test successful"),this.isConnected=!0),this.connectionChecked=!0,this.isConnected}catch(t){return console.error("âŒ Connection error:",t.message),this.isConnected=!1,this.connectionChecked=!0,!1}}async getNotes(){if(!await this.checkConnection())return console.warn("âš ï¸ Supabase not connected, returning empty array"),[];console.log("ðŸ“¥ Fetching notes from Supabase...");try{const{data:r,error:e}=await this.client.from("notes").select("*").order("created_at",{ascending:!1});return e?(console.error("âŒ Error fetching notes:",e),[]):(console.log(`âœ… Loaded ${r?.length||0} notes`),r||[])}catch(r){return console.error("âŒ Failed to fetch notes:",r),[]}}async addNote(t){if(!await this.checkConnection())throw new Error("âŒ Supabase not connected");console.log("ðŸ’¾ Saving note to Supabase...");const e={title:t.title?.trim()||"",subject:t.subject||"other",content:t.content?.trim()||"",author:t.author?.trim()||"Anonim",likes_count:parseInt(t.likes)||0,dislikes_count:parseInt(t.dislikes)||0};t.image&&t.image!=="null"&&(e.image_url=t.image);try{const{data:o,error:n}=await this.client.from("notes").insert([e]).select();if(n)throw console.error("âŒ Error adding note:",n),new Error(`Failed to save: ${n.message}`);return console.log(`âœ… Note saved with ID: ${o[0]?.id}`),o[0]}catch(o){throw console.error("âŒ Failed to add note:",o),o}}async deleteNote(t){if(!await this.checkConnection())throw new Error("âŒ Supabase not connected");console.log(`ðŸ—‘ï¸ Deleting note: ${t}`);try{const{error:e}=await this.client.from("likes").delete().eq("note_id",t);e&&console.warn("âš ï¸ Error deleting likes:",e.message);const{error:o}=await this.client.from("comments").delete().eq("note_id",t);o&&console.warn("âš ï¸ Error deleting comments:",o.message);const{error:n}=await this.client.from("notes").delete().eq("id",t);if(n)throw console.error("âŒ Error deleting note:",n),n;return console.log("âœ… Note and all related data deleted"),!0}catch(e){throw console.error("âŒ Failed to delete note:",e),e}}async getLikes(t){if(!await this.checkConnection())return[];try{const{data:e,error:o}=await this.client.from("likes").select("*").eq("note_id",t);return o?(console.error("âŒ Error fetching likes:",o),[]):e||[]}catch(e){return console.error("âŒ Failed to fetch likes:",e),[]}}async toggleLike(t,r,e="like"){if(!await this.checkConnection())throw new Error("âŒ Supabase not connected");try{const{data:n,error:l}=await this.client.from("likes").select("*").eq("note_id",t).eq("user_id",r).maybeSingle();if(l&&l.code!=="PGRST116")throw console.error("âŒ Error checking reaction:",l),l;if(n)if(n.type===e){const{error:c}=await this.client.from("likes").delete().eq("id",n.id);if(c)throw c;return{reaction:null,type:"removed"}}else{const{data:c,error:i}=await this.client.from("likes").update({type:e}).eq("id",n.id).select();if(i)throw i;return{reaction:c[0],type:"updated"}}else{const{data:c,error:i}=await this.client.from("likes").insert([{note_id:t,user_id:r,type:e}]).select();if(i)throw i;return{reaction:c[0],type:"added"}}}catch(n){throw console.error("âŒ Failed to toggle like:",n),n}}async getComments(t){if(!await this.checkConnection())return[];try{const{data:e,error:o}=await this.client.from("comments").select("*").eq("note_id",t).order("created_at",{ascending:!0});return o?(console.error("âŒ Error fetching comments:",o),[]):e||[]}catch(e){return console.error("âŒ Failed to fetch comments:",e),[]}}async addComment(t){if(!await this.checkConnection())throw new Error("âŒ Supabase not connected");console.log("ðŸ’¬ Adding comment to Supabase...");try{const{data:e,error:o}=await this.client.from("comments").insert([{note_id:t.noteId,author:t.author?.trim()||"Anonim",text:t.text?.trim()||""}]).select();if(o)throw console.error("âŒ Error adding comment:",o),o;return console.log("âœ… Comment saved"),e[0]}catch(e){throw console.error("âŒ Failed to add comment:",e),e}}async updateNoteStats(t,r,e){if(!await this.checkConnection())return!1;try{const{error:n}=await this.client.from("notes").update({likes_count:parseInt(r)||0,dislikes_count:parseInt(e)||0}).eq("id",t);return n?(console.error("âŒ Error updating note stats:",n),!1):!0}catch(n){return console.error("âŒ Failed to update note stats:",n),!1}}async getTotalLikes(){if(!await this.checkConnection())return 0;try{const{data:r,error:e}=await this.client.from("notes").select("likes_count");return e?0:r.reduce((o,n)=>o+(n.likes_count||0),0)}catch{return 0}}async getTotalComments(){if(!await this.checkConnection())return 0;try{const{count:r,error:e}=await this.client.from("comments").select("*",{count:"exact",head:!0});return e?0:r||0}catch{return 0}}}d=new a,console.log("âœ… SupabaseService initialized"),setTimeout(async()=>{console.log("ðŸ§ª Testing connection after initialization...");const s=await d.checkConnection();console.log(`ðŸ“Š Final connection status: ${s?"âœ… Connected":"âŒ Not Connected"}`)},1e3)}catch(a){console.error("âŒ Failed to initialize Supabase:",a),d={client:null,isConnected:!1,connectionChecked:!0,checkConnection:async()=>(console.log("âš ï¸ Fallback service - no connection"),!1),getNotes:async()=>(console.log("âš ï¸ Fallback service - returning empty notes"),[]),addNote:async()=>{throw console.log("âš ï¸ Fallback service - cannot add note"),new Error("Supabase not available")},deleteNote:async()=>{throw console.log("âš ï¸ Fallback service - cannot delete note"),new Error("Supabase not available")},getLikes:async()=>[],toggleLike:async()=>{throw new Error("Supabase not available")},getComments:async()=>[],addComment:async()=>{throw new Error("Supabase not available")},updateNoteStats:async()=>!1,getTotalLikes:async()=>0,getTotalComments:async()=>0}}window.supabaseService=d;console.log("âœ… Supabase service exposed to window");
