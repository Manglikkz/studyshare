import"./supabase-config-DZCgFw4-.js";const x="43b8b9a93cad118ac975ffca46a7fa255dee022a7c4e96f0b2a122b876bda151",l="#4a90e2";class k{static async sha256(e){const a=new TextEncoder().encode(e),n=await crypto.subtle.digest("SHA-256",a);return Array.from(new Uint8Array(n)).map(d=>d.toString(16).padStart(2,"0")).join("")}static async verifyPassword(e,t){try{return await this.sha256(e)===t}catch(a){return console.error("Password verification error:",a),!1}}}class c{static show(e="Memproses..."){this.hide();const t=document.createElement("div");t.id="admin-loading-spinner",t.style.cssText=`
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(255, 255, 255, 0.95);
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            z-index: 9999; backdrop-filter: blur(5px);
        `,t.innerHTML=`
            <div class="spinner-container" style="text-align: center; padding: 2rem; border-radius: 20px; background: linear-gradient(135deg, rgba(74, 144, 226, 0.1) 0%, rgba(123, 184, 241, 0.1) 100%); border: 1px solid rgba(74, 144, 226, 0.2); box-shadow: 0 10px 30px rgba(74, 144, 226, 0.2);">
                <div class="spinner" style="width: 60px; height: 60px; border: 4px solid rgba(74, 144, 226, 0.1); border-top: 4px solid ${l}; border-radius: 50%; animation: spin 1s linear infinite; margin: 0 auto 20px;"></div>
                <p style="color: ${l}; font-size: 1.1rem; font-weight: 500; margin: 0;">${e}</p>
            </div>
        `,document.body.appendChild(t)}static hide(){const e=document.getElementById("admin-loading-spinner");e&&(e.style.animation="fadeOut 0.3s ease-out",setTimeout(()=>e.remove(),300))}}class r{static show(e,t="info",a=3e3){const n=document.querySelector(".admin-custom-alert");n&&n.remove();const s=document.createElement("div");s.className=`admin-custom-alert admin-custom-alert-${t}`;let o,d,m,u;t==="success"?(o="rgba(16, 185, 129, 0.1)",d="#10b981",m="#10b981",u="‚úì"):t==="error"?(o="rgba(239, 68, 68, 0.1)",d="#ef4444",m="#ef4444",u="‚úó"):t==="warning"?(o="rgba(245, 158, 11, 0.1)",d="#f59e0b",m="#f59e0b",u="‚ö†"):(o="rgba(74, 144, 226, 0.1)",d=l,m=l,u="‚Ñπ"),s.style.cssText=`
            position: fixed; top: 20px; right: 20px; background: ${o}; color: ${d}; border: 1px solid ${m};
            padding: 16px 20px; border-radius: 12px; display: flex; align-items: center; gap: 12px; z-index: 9999;
            backdrop-filter: blur(10px); box-shadow: 0 10px 25px rgba(0, 0, 0, 0.15); max-width: 400px;
            animation: slideInRight 0.3s ease-out; transition: all 0.3s ease;
        `,s.innerHTML=`
            <span class="admin-alert-icon" style="font-size: 1.2rem;">${u}</span>
            <span class="admin-alert-message">${e}</span>
            <button class="admin-alert-close" style="background: none; border: none; color: ${d}; font-size: 1.5rem; cursor: pointer; margin-left: auto; padding: 0; line-height: 1; opacity: 0.7;">√ó</button>
        `,document.body.appendChild(s),s.querySelector(".admin-alert-close").addEventListener("click",()=>{s.style.animation="slideOutRight 0.3s ease-out",setTimeout(()=>s.remove(),300)}),a>0&&setTimeout(()=>{s.parentNode&&(s.style.animation="slideOutRight 0.3s ease-out",setTimeout(()=>s.remove(),300))},a)}}class b{static show(e,t,a=null){this.hide();const n=document.createElement("div");n.id="admin-confirm-dialog-overlay",n.style.cssText=`
            position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0, 0, 0, 0.5);
            display: flex; align-items: center; justify-content: center; z-index: 10000; animation: fadeIn 0.3s ease-out;
        `,n.innerHTML=`
            <div class="admin-confirm-dialog" style="background: white; padding: 2rem; border-radius: 16px; box-shadow: 0 20px 60px rgba(74, 144, 226, 0.3); max-width: 400px; width: 90%; text-align: center; animation: slideInUp 0.3s ease-out;">
                <h3 style="margin-bottom: 1rem; color: #2d3748;">Konfirmasi</h3>
                <p style="margin-bottom: 1.5rem; color: #718096; line-height: 1.5;">${e}</p>
                <div style="display: flex; gap: 1rem; justify-content: center;">
                    <button id="admin-confirm-cancel" style="background: #e2e8f0; color: #2d3748; border: none; padding: 0.8rem 1.5rem; border-radius: 8px; cursor: pointer; transition: all 0.3s ease; font-weight: 500;">Batal</button>
                    <button id="admin-confirm-ok" style="background: ${l}; color: white; border: none; padding: 0.8rem 1.5rem; border-radius: 8px; cursor: pointer; transition: all 0.3s ease; font-weight: 500;">Ya, Hapus</button>
                </div>
            </div>
        `,document.body.appendChild(n),document.getElementById("admin-confirm-ok").addEventListener("click",()=>{this.hide(),t&&t()}),document.getElementById("admin-confirm-cancel").addEventListener("click",()=>{this.hide(),a&&a()})}static hide(){const e=document.getElementById("admin-confirm-dialog-overlay");e&&e.remove()}}class S{constructor(){this.notes=[],this.supabaseService=null,this.isInitialized=!1}async init(){await this.waitForSupabase(),await this.loadData(),this.isInitialized=!0}async waitForSupabase(){return typeof window.supabaseService<"u"&&window.supabaseService?(this.supabaseService=window.supabaseService,!0):new Promise((e,t)=>{let a=0;const n=50,s=setInterval(()=>{a++,typeof window.supabaseService<"u"&&window.supabaseService?(this.supabaseService=window.supabaseService,clearInterval(s),e(!0)):a>=n&&(clearInterval(s),t(new Error("Supabase service not available")))},100)})}async loadData(){try{if(c.show("Memuat data admin..."),!this.supabaseService)throw new Error("Supabase service tidak tersedia");if(await this.supabaseService.checkConnection(),!this.supabaseService.isConnected)throw new Error("Tidak terhubung ke database");await this.loadFromSupabase(),await this.loadStats(),r.show("Data admin berhasil dimuat!","success",2e3)}catch(e){console.error("Error loading data:",e),this.notes=[],this.updateStats(0,0,0),r.show(`Gagal memuat data: ${e.message}`,"error",4e3),this.renderErrorState(e.message)}finally{c.hide()}}renderErrorState(e){const t=document.getElementById("adminNotesContainer");t&&(t.innerHTML=`
                <div class="empty-state">
                    <h3 style="color: #ef4444;">‚ùå Gagal Memuat Data</h3>
                    <p style="color: #718096;">${e}</p>
                    <button onclick="retryLoadAdminData()" class="btn-primary" style="margin-top: 1rem;">üîÑ Coba Lagi</button>
                </div>`)}async loadFromSupabase(){const e=await this.supabaseService.getNotes();if(!e||!Array.isArray(e)){this.notes=[];return}this.notes=e.map(t=>({id:t.id,title:t.title||"",subject:t.subject||"other",content:t.content||"",author:t.author||"Anonim",date:t.created_at||new Date().toISOString(),likes:t.likes_count||0,dislikes:t.dislikes_count||0,image:t.image_url}))}async loadStats(){try{const e=await this.supabaseService.getTotalLikes(),t=await this.supabaseService.getTotalComments();this.updateStats(this.notes.length,e,t)}catch{const t=this.notes.reduce((a,n)=>a+(n.likes||0),0);this.updateStats(this.notes.length,t,0)}}updateStats(e,t,a){const n=document.getElementById("totalNotes"),s=document.getElementById("totalLikes"),o=document.getElementById("totalComments");n&&(n.textContent=e),s&&(s.textContent=t),o&&(o.textContent=a)}async deleteNote(e){if(!this.supabaseService||!this.supabaseService.isConnected)throw new Error("Tidak terhubung ke server");try{return c.show("Menghapus catatan..."),await this.supabaseService.deleteNote(e),!0}finally{c.hide()}}}const p=new S,g={escapeHtml(i){if(!i)return"";const e=document.createElement("div");return e.textContent=i,e.innerHTML},formatDate(i){try{return new Date(i).toLocaleDateString("id-ID",{day:"numeric",month:"long",year:"numeric",hour:"2-digit",minute:"2-digit"})}catch{return"Tanggal tidak valid"}},getSubjectName(i){return{"bahasa-arab":"Bahasa Arab",nahwu:"Nahwu",shorof:"Shorof",tahfidz:"Tahfidz",tahsin:"Tahsin",aqidah:"Aqidah",fikih:"Fikih",hadits:"Hadits","adab-akhlaq":"Adab & Akhlaq","bahasa-inggris":"Bahasa Inggris",matematika:"Matematika",bootcamp:"Bootcamp"}[i]||i}};async function h(){const i=document.getElementById("adminPassword"),e=i.value;if(!e){r.show("Harap masukkan password!","warning",3e3);return}try{c.show("Verifikasi...");const t=await k.verifyPassword(e,x);c.hide(),t?(sessionStorage.setItem("adminLoggedIn","true"),sessionStorage.setItem("adminLoginTime",Date.now()),y(),r.show("Login berhasil! Selamat datang Admin!","success",2e3),i.value=""):(r.show("Password admin salah!","error",3e3),i.value="",i.focus())}catch(t){c.hide(),console.error("Login error:",t),r.show("Terjadi kesalahan saat login","error",3e3)}}function I(){b.show("Apakah Anda yakin ingin logout?",()=>{sessionStorage.removeItem("adminLoggedIn"),sessionStorage.removeItem("adminLoginTime"),f(),r.show("Logout berhasil!","success",2e3)})}function f(){document.getElementById("adminLogin").style.display="block",document.getElementById("adminPanel").style.display="none";const i=document.getElementById("adminPassword");i&&(i.value="")}function y(){document.getElementById("adminLogin").style.display="none",document.getElementById("adminPanel").style.display="block";const i=document.getElementById("adminNotesContainer");i&&(i.innerHTML='<div class="loading-state"><div class="loading-spinner"></div><p>Memuat data admin...</p></div>'),setTimeout(()=>w(),100)}async function w(){p.isInitialized||await p.init(),v(p.notes)}async function L(){await w()}function v(i){const e=document.getElementById("adminNotesContainer");if(!e)return;if(!i||i.length===0){e.innerHTML=`
            <div class="empty-state">
                <h3 style="color: #4a90e2;">üìù Belum Ada Catatan</h3>
                <p style="color: #718096;">Tidak ada catatan di database.</p>
                <a href="upload.html" class="btn-primary" style="margin-top: 1rem;">üì§ Upload Catatan</a>
            </div>`;return}const t=document.createDocumentFragment();i.forEach(a=>{const n=document.createElement("div");n.className="admin-note-item",n.style.cssText=`background: white; border-radius: 12px; padding: 1.5rem; display: flex; justify-content: space-between; align-items: flex-start; gap: 1.5rem; border-left: 4px solid ${l}; transition: all 0.3s ease; margin-bottom: 1rem; box-shadow: 0 5px 15px rgba(0,0,0,0.05);`,n.innerHTML=`
            <div class="admin-note-content" style="flex: 1;">
                <div class="note-header" style="display: flex; justify-content: space-between; margin-bottom: 1rem;">
                    <h4 style="margin: 0; font-size: 1.2rem;">${g.escapeHtml(a.title)}</h4>
                    <span class="subject-tag" style="background: ${l}; color: white; padding: 0.3rem 0.8rem; border-radius: 20px; font-size: 0.8rem;">${g.getSubjectName(a.subject)}</span>
                </div>
                <div class="note-details" style="display: grid; gap: 0.5rem; font-size: 0.9rem; color: #718096;">
                    <p><strong>‚úçÔ∏è Penulis:</strong> ${g.escapeHtml(a.author)}</p>
                    <p><strong>üìÖ Tanggal:</strong> ${g.formatDate(a.date)}</p>
                    <p><strong>üëç Like:</strong> ${a.likes} | <strong>üëé Dislike:</strong> ${a.dislikes}</p>
                    <p><strong>üìù Isi:</strong> ${g.escapeHtml(a.content.substring(0,100))}...</p>
                </div>
            </div>
            <div class="admin-note-actions">
                <button class="btn-danger" onclick="deleteNote('${a.id}', this)" style="background: #ef4444; color: white; border: none; padding: 0.6rem 1rem; border-radius: 8px; cursor: pointer;">üóëÔ∏è Hapus</button>
            </div>
        `,t.appendChild(n)}),e.innerHTML="",e.appendChild(t)}window.deleteNote=async function(i,e){b.show("Apakah Anda yakin ingin menghapus catatan ini secara permanen?",async()=>{const t=e.innerHTML;e.innerHTML="‚è≥",e.disabled=!0;try{await p.deleteNote(i);const a=e.closest(".admin-note-item");a&&a.remove();const n=document.querySelectorAll(".admin-note-item").length;document.getElementById("totalNotes").textContent=n,n===0&&v([]),r.show("Catatan dihapus!","success",3e3)}catch(a){e.innerHTML=t,e.disabled=!1,r.show(`Gagal menghapus: ${a.message}`,"error",4e3)}})};document.addEventListener("DOMContentLoaded",function(){console.log("üîê Admin page loaded...");const i=document.getElementById("loginBtn");i&&i.addEventListener("click",h);const e=document.getElementById("adminPassword");e&&e.addEventListener("keypress",s=>{s.key==="Enter"&&h()}),window.loginAdmin=h,window.logoutAdmin=I,window.retryLoadAdminData=L,console.log("‚úÖ Fungsi Admin berhasil didaftarkan ke Window");const t=sessionStorage.getItem("adminLoggedIn")==="true",a=parseInt(sessionStorage.getItem("adminLoginTime")||"0");t&&Date.now()-a<7200*1e3?y():(sessionStorage.removeItem("adminLoggedIn"),f())});
